<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Duty Assignment</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      background: #f9f9f9;
      font-size: 12px;
    }
    .controls {
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .controls button {
      flex: 1;
      min-width: 80px;
      padding: 5px;
      font-size: 11px;
      border: none;
      border-radius: 3px;
      color: white;
      cursor: pointer;
    }
    .btn-ticked { background:#28a745; }
    .btn-unticked { background:#ffc107; color:black; }
    .btn-all { background:#6c757d; }
    .btn-clear { background:#dc3545; }
    .btn-home { background:#6c757d; }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      font-size: 12px;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 3px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
      font-size: 12px;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    td.name-cell {
      text-align: left;
      border-right: 3px solid #000;
    }
    td.n-cell {
      border-right: 3px solid #000;
    }
    input[type="checkbox"] {
      width: 14px;
      height: 14px;
    }
    #itemCount {
      margin-top: 6px;
      font-weight: bold;
      text-align: right;
      font-size: 12px;
    }
    /* Zebra stripes */
    #itemsTable tbody tr:nth-child(odd) {
      background-color: #ffffff;
    }
    #itemsTable tbody tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    /* Bold line when reset */
    .reset-top td {
      border-top: 3px solid #000 !important;
    }
    /* Row highlights */
    .pair1-highlight { background-color: #d6eaff !important; }
    .pair2-highlight { background-color: #d6ffd6 !important; }
    .pair3-highlight { background-color: #ffe6e6 !important; }
    .row-gray { background-color: #e0e0e0 !important; text-decoration: line-through; color: #555; }
    /* Name highlights */
    .ic-highlight { background-color: #ff8c00 !important; color:white; }
    .second-highlight { background-color: #ffd699 !important; }
    .both-highlight { background-color: #ffb84d !important; }
  </style>
</head>
<body>

  <div class="controls">
    <button class="btn-ticked" onclick="filterTicked()">Show Ticked</button>
    <button class="btn-unticked" onclick="filterUnticked()">Show Unticked</button>
    <button class="btn-all" onclick="showAll()">Show All</button>
    <button class="btn-clear" onclick="untickAll()">Untick All</button>
    <button class="btn-home" onclick="window.location.href='index.html'">Back to Home</button>
  </div>

  <table id="itemsTable">
    <thead>
      <tr>
        <th>âœ“</th>
        <th>I/C</th>
        <th>2nd</th>
        <th>Name</th>
        <th>PO</th>
        <th>PA</th>
        <th>A</th>
        <th class="n-head">N</th>
        <th>@</th>
        <th>#</th>
        <th>%</th>
        <th>2in1</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="itemCount">Total Items: 0</div>

  <script>
    const headers = ["PO", "PA", "A", "N", "@", "#", "%", "2in1"];
    const API_URL = "https://names-backend-production.up.railway.app/names";

    window.addEventListener("DOMContentLoaded", () => {
      fetch(API_URL)
        .then(res => {
          if (!res.ok) throw new Error("API error");
          return res.text();
        })
        .then(text => {
          const lines = text.split("\n");
          buildTable(lines);
        })
        .catch(err => {
          console.error("Error loading names from API:", err);
          alert("Could not load names from backend API.");
        });
    });

    function buildTable(lines) {
      const tableBody = document.querySelector("#itemsTable tbody");
      let counter = 0;

      lines.forEach(line => {
        const name = line.trim();

        if (name === "") {
          counter = 0; // reset numbering
          return; // skip adding row
        }

        counter++;
        const row = document.createElement("tr");

        // ðŸ‘‰ mark row if it's the first after reset
        if (counter === 1) {
          row.classList.add("reset-top");
        }

        // First âœ“
        const tickCell = document.createElement("td");
        const rowCheckbox = document.createElement("input");
        rowCheckbox.type = "checkbox";
        rowCheckbox.addEventListener("change", () => toggleRowGray(row, rowCheckbox));
        tickCell.appendChild(rowCheckbox);
        row.appendChild(tickCell);

        // I/C
        const icCell = document.createElement("td");
        const icCheckbox = document.createElement("input");
        icCheckbox.type = "checkbox";
        icCheckbox.addEventListener("change", () => applyRowHighlight(row));
        icCell.appendChild(icCheckbox);
        row.appendChild(icCell);

        // 2nd
        const secondCell = document.createElement("td");
        const secondCheckbox = document.createElement("input");
        secondCheckbox.type = "checkbox";
        secondCheckbox.addEventListener("change", () => applyRowHighlight(row));
        secondCell.appendChild(secondCheckbox);
        row.appendChild(secondCell);

        // Name
        const nameCell = document.createElement("td");
        nameCell.classList.add("name-cell");

        nameCell.appendChild(document.createTextNode(counter + ". "));

        const parts = name.split(/\s+/);
        if (parts.length > 0) {
          const strong = document.createElement("strong");
          strong.textContent = parts[0];
          nameCell.appendChild(strong);
          if (parts.length > 1) {
            nameCell.appendChild(document.createTextNode(" " + parts.slice(1).join(" ")));
          }
        }

        row.appendChild(nameCell);

        // Other headers
        headers.forEach(header => {
          const td = document.createElement("td");
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.addEventListener("change", () => applyRowHighlight(row));
          if (header === "N") td.classList.add("n-cell");
          td.appendChild(checkbox);
          row.appendChild(td);
        });

        tableBody.appendChild(row);
      });

      updateItemCount();
    }

    function toggleRowGray(row, cb) {
      if (cb.checked) row.classList.add("row-gray");
      else row.classList.remove("row-gray");
    }

    function updateItemCount() {
      const visibleRows = Array.from(document.querySelectorAll("#itemsTable tbody tr"))
        .filter(row => row.style.display !== "none");
      document.getElementById("itemCount").textContent = "Total Items: " + visibleRows.length;
    }

    function applyRowHighlight(row) {
      row.classList.remove("pair1-highlight", "pair2-highlight", "pair3-highlight");
      const nameCell = row.cells[3];
      nameCell.classList.remove("ic-highlight", "second-highlight", "both-highlight");

      const ic = row.cells[1].querySelector("input");
      const second = row.cells[2].querySelector("input");
      const pair1 = row.cells[8].querySelector("input");
      const pair2 = row.cells[9].querySelector("input");
      const pair3 = row.cells[10].querySelector("input");

      if (ic && ic.checked && second && second.checked) {
        nameCell.classList.add("both-highlight");
      } else if (ic && ic.checked) {
        nameCell.classList.add("ic-highlight");
      } else if (second && second.checked) {
        nameCell.classList.add("second-highlight");
      }

      if (pair3 && pair3.checked) row.classList.add("pair3-highlight");
      else if (pair2 && pair2.checked) row.classList.add("pair2-highlight");
      else if (pair1 && pair1.checked) row.classList.add("pair1-highlight");
    }

    function filterTicked() {
      document.querySelectorAll("#itemsTable tbody tr").forEach(row => {
        const isTicked = Array.from(row.querySelectorAll("input[type=checkbox]")).some(chk => chk.checked);
        row.style.display = isTicked ? "" : "none";
      });
      updateItemCount();
    }

    function filterUnticked() {
      document.querySelectorAll("#itemsTable tbody tr").forEach(row => {
        const isTicked = Array.from(row.querySelectorAll("input[type=checkbox]")).some(chk => chk.checked);
        row.style.display = isTicked ? "none" : "";
      });
      updateItemCount();
    }

    function showAll() {
      document.querySelectorAll("#itemsTable tbody tr").forEach(row => row.style.display = "");
      updateItemCount();
    }

    function untickAll() {
      document.querySelectorAll("#itemsTable tbody input[type=checkbox]").forEach(chk => chk.checked = false);
      document.querySelectorAll("#itemsTable tbody tr").forEach(row => {
        row.classList.remove("pair1-highlight", "pair2-highlight", "pair3-highlight", "row-gray");
        row.cells[3].classList.remove("ic-highlight", "second-highlight", "both-highlight");
      });
      showAll();
    }
  </script>
</body>
</html>
